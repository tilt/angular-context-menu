angular.module("ng-context-menu",[]).factory("ngContextMenu",["$q","$http","$compile","$templateCache","$animate","$rootScope","$controller",function(e,t,n,o,r,a,l){return function(i){function c(e,t){return g&&e&&f(e),s.then(function(n){return h||u(n,e),t&&h.css(t),h})}function u(e,t){if(x=angular.element(i.container||document.body),h=angular.element(e),0===h.length)throw new Error("The template contains no elements; you need to wrap text nodes");r.enter(h,x),g=a.$new(),t&&f(t);var o=l(v,{$scope:g});d&&(g[d]=o),n(h)(g)}function f(e){for(var t in e)g[t]=e[t]}function p(){var t=e.defer();return h?r.leave(h,function(){g.$destroy(),h=null,t.resolve()}):t.resolve(),t.promise}function m(){return!!h}if(!(!i.template^!i.templateUrl))throw new Error("Expected context menu to have exacly one of either `template` or `templateUrl`");var s,g,v=(i.template,i.controller||angular.noop),d=i.controllerAs,h=null,x=null;if(i.template){var $=e.defer();$.resolve(i.template),s=$.promise}else s=t.get(i.templateUrl,{cache:o}).then(function(e){return e.data});return{open:c,close:p,active:m}}}]).directive("hasContextMenu",["$injector","$window","$parse","$timeout",function(e,t,n,o){return{restrict:"A",link:function(n,r,a){function l(e){var t=s.open(g,c(e));t.then(function(e){angular.element(e).trap()})}function i(){s.close(),m&&o(function(){m.focus()})}function c(e){var t={};if(e.pageX&&e.pageY)t.top=Math.max(e.pageY,0)+"px",t.left=Math.max(e.pageX,0)+"px";else{var n=angular.element(m)[0].getBoundingClientRect();t.top=Math.max(n.bottom,0)+"px",t.left=Math.max(n.left,0)+"px"}return t}function u(e){m=e.target,e.preventDefault(),e.stopPropagation(),n.$apply(function(){l(e)})}function f(){n.$apply(function(){i()})}function p(e){s.active()&&m&&2!==e.button&&f()}var m,s=e.get(a.target),g={},v=angular.element(t),d=a.triggerOnEvent||"contextmenu";if(a.locals){var h=a.locals.split(",").map(function(e){return e.trim()});angular.forEach(h,function(e){g[e]=n[e]})}r.bind(d,function(e){u(e)}),v.bind("keyup",function(e){s.active()&&27===e.keyCode&&f(),67===e.keyCode&&e.shiftKey&&(s.active()||u(e))}),v.bind("click",p),v.bind(d,p)}}}]);