angular.module("ng-context-menu",[]).factory("ngContextMenu",["$q","$http","$timeout","$compile","$templateCache","$animate","$rootScope","$controller",function(e,t,n,o,r,c,i,l){return function(a){function u(e,t){return h&&e&&p(e),g.then(function(n){return w||f(n,e),t&&w.css(t),s(w),w})}function f(e,t){if(x=angular.element(a.container||document.body),w=angular.element(e),0===w.length)throw new Error("The template contains no elements; you need to wrap text nodes");c.enter(w,x),h=i.$new(),t&&p(t);var n=l(v,{$scope:h});$&&(h[$]=n),o(w)(h)}function p(e){for(var t in e)h[t]=e[t]}function m(){var t=e.defer();return w?c.leave(w,function(){h.$destroy(),w=null,t.resolve()}):t.resolve(),t.promise}function s(e){var t="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,o="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth;n(function(){t<e[0].offsetTop+e[0].offsetHeight&&e.css("top",e[0].offsetTop-e[0].offsetHeight+"px"),o<e[0].offsetLeft+e[0].offsetWidth&&e.css("left",e[0].offsetLeft-e[0].offsetWidth+"px")},0)}function d(){return!!w}if(!(!a.template^!a.templateUrl))throw new Error("Expected context menu to have exacly one of either `template` or `templateUrl`");var g,h,v=(a.template,a.controller||angular.noop),$=a.controllerAs,w=null,x=null;if(a.template){var k=e.defer();k.resolve(a.template),g=k.promise}else g=t.get(a.templateUrl,{cache:r}).then(function(e){return e.data});return{open:u,close:m,active:d}}}]).directive("hasContextMenu",["$injector","$document","$parse",function(e,t,n){return{restrict:"A",link:function(n,o,r){function c(e){f.open(p,l(e))}function i(){f.close()}function l(e){return e.pageX||e.pageY?(clickX=e.pageX,clickY=e.pageY):(clickX=e.clientX+document.documentElement.scrollLeft,clickY=e.clientY+document.documentElement.scrollTop),{left:Math.max(clickX,0)+"px",top:Math.max(clickY,0)+"px"}}function a(e){f.active()&&u&&2!==e.button&&n.$apply(function(){i()})}var u,f=e.get(r.target),p={},m=angular.element(t),s=r.triggerOnEvent||"contextmenu";if(r.locals){var d=r.locals.split(",");angular.forEach(d,function(e){e=e.trim(),p[e]=n[e]})}o.bind(s,function(e){u=e.target,e.preventDefault(),e.stopPropagation(),n.$apply(function(){c(e)})}),m.bind("keyup",function(e){f.active()&&27===e.keyCode&&n.$apply(function(){i()})}),m.bind("click",a),m.bind(s,a)}}}]);